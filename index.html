<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –¥–æ–∑–∞—Ç–æ—Ä–∞ ‚Ä¢ –ê—Ç–ª–∞—Å –ü—Ä–æ</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-page:    #e8f0f7;
    --bg-white:   #ffffff;
    --bg-input:   #ffffff;
    --border:     #d0dce8;
    --border-focus: #2b7de9;
    --blue:       #2b7de9;
    --blue-dark:  #1a5dbf;
    --blue-light: #e8f2fd;
    --blue-text:  #2563a8;
    --orange:     #f47c20;
    --orange-dark:#d96310;
    --green:      #1a9e5c;
    --green-bg:   #e8f7f0;
    --red:        #d93b3b;
    --red-bg:     #fde8e8;
    --text:       #1a2332;
    --text-2:     #4a5568;
    --text-3:     #8a9ab0;
    --shadow:     0 2px 12px rgba(43,125,233,0.10);
    --shadow-lg:  0 4px 24px rgba(43,125,233,0.13);
    --radius:     10px;
    --radius-sm:  6px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg-page);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    background: var(--bg-white);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 70px;
    box-shadow: 0 1px 4px rgba(43,125,233,0.08);
  }
  .header-left { display: flex; align-items: center; gap: 20px; }
  .logo-wrap { display: flex; align-items: center; gap: 10px; text-decoration: none; }

  /* SVG logo mark ‚Äî triangle like Atlas */
  .logo-icon { width: 42px; height: 42px; }

  .logo-text-block { display: flex; flex-direction: column; line-height: 1; }
  .logo-name {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 2px;
    color: var(--blue-dark);
    text-transform: uppercase;
  }
  .logo-tagline {
    font-size: 8px;
    color: var(--text-3);
    letter-spacing: 0.8px;
    text-transform: uppercase;
    margin-top: 3px;
    line-height: 1.3;
  }
  .header-divider {
    width: 1px; height: 36px;
    background: var(--border);
  }
  .header-title h1 {
    font-size: 18px;
    font-weight: 600;
    color: var(--text);
  }
  .header-title p {
    font-size: 12px;
    color: var(--text-3);
    margin-top: 2px;
  }
  .btn-orange {
    background: var(--orange);
    color: #fff;
    border: none;
    padding: 9px 20px;
    border-radius: var(--radius-sm);
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: background .15s;
    white-space: nowrap;
  }
  .btn-orange:hover { background: var(--orange-dark); }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .app {
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 20px;
    padding: 24px 28px;
    max-width: 1400px;
    margin: 0 auto;
    align-items: start;
  }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--bg-white);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 22px 20px;
    margin-bottom: 16px;
  }
  .card:last-child { margin-bottom: 0; }

  .card-title {
    font-size: 15px;
    font-weight: 600;
    color: var(--blue-text);
    margin-bottom: 16px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--blue-light);
  }

  /* ‚îÄ‚îÄ FIELDS ‚îÄ‚îÄ */
  .field { margin-bottom: 12px; }
  .field:last-child { margin-bottom: 0; }
  label {
    display: block;
    font-size: 12px;
    color: var(--text-2);
    margin-bottom: 5px;
    font-weight: 500;
  }
  label .unit { color: var(--text-3); font-weight: 400; }
  input[type="number"], input[type="text"] {
    width: 100%;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 500;
    padding: 8px 11px;
    outline: none;
    transition: border-color .15s, box-shadow .15s;
  }
  input:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(43,125,233,.12);
  }
  .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }

  /* ‚îÄ‚îÄ ITEM CARDS (dozator/product) ‚îÄ‚îÄ */
  .doz-item {
    background: #f7fafd;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px;
    margin-bottom: 10px;
    border-top: 3px solid var(--blue);
  }
  .doz-item:last-child { margin-bottom: 0; }
  .prod-item {
    background: #fffbf5;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px;
    margin-bottom: 10px;
    border-top: 3px solid var(--orange);
  }
  .prod-item:last-child { margin-bottom: 0; }

  .item-hd {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .item-name { font-size: 12px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; }
  .doz-item .item-name { color: var(--blue); }
  .prod-item .item-name { color: var(--orange); }

  .btn-del {
    background: none;
    border: 1px solid var(--border);
    color: var(--text-3);
    width: 22px; height: 22px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    display: flex; align-items: center; justify-content: center;
    transition: all .15s;
  }
  .btn-del:hover { border-color: var(--red); color: var(--red); background: var(--red-bg); }

  /* Sub-section inside item */
  .sub-sec {
    background: var(--bg-white);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 12px;
    margin-top: 10px;
  }
  .sub-sec-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }

  /* Live preview badge */
  .derived {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--blue-light);
    border: 1px solid #c5ddf7;
    border-radius: 5px;
    padding: 5px 9px;
    font-size: 11px;
    font-weight: 500;
    color: var(--blue-text);
    margin-top: 8px;
  }

  /* ‚îÄ‚îÄ ADD / ACTION BUTTONS ‚îÄ‚îÄ */
  .btn-add {
    width: 100%;
    background: transparent;
    border: 1px dashed #b0c8e4;
    color: var(--blue);
    padding: 9px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all .15s;
    margin-top: 8px;
  }
  .btn-add:hover { border-color: var(--blue); background: var(--blue-light); }

  .btn-add-orange {
    border-color: #f5c89a;
    color: var(--orange);
  }
  .btn-add-orange:hover { border-color: var(--orange); background: #fff5ec; }

  .btn-calc {
    width: 100%;
    background: var(--blue);
    color: #fff;
    border: none;
    padding: 13px;
    border-radius: var(--radius-sm);
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: background .15s, box-shadow .15s;
    letter-spacing: 0.3px;
  }
  .btn-calc:hover { background: var(--blue-dark); box-shadow: 0 4px 16px rgba(43,125,233,.35); }
  .btn-calc:active { transform: scale(.99); }

  /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
  .sec-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--blue-text);
    margin-bottom: 10px;
  }

  /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
  .placeholder {
    background: var(--bg-white);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 60px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: var(--text-3);
    text-align: center;
  }
  .placeholder .ico { font-size: 40px; opacity: .35; }
  .placeholder p { font-size: 13px; line-height: 1.7; }

  /* KPI CARDS */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 16px;
  }
  .kpi {
    background: var(--bg-white);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }
  .kpi::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 3px;
  }
  .kpi.c-blue::after   { background: var(--blue); }
  .kpi.c-green::after  { background: var(--green); }
  .kpi.c-orange::after { background: var(--orange); }

  .kpi-lbl {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
  }
  .kpi-val {
    font-size: 26px;
    font-weight: 700;
    line-height: 1;
  }
  .kpi.c-blue .kpi-val   { color: var(--blue); }
  .kpi.c-green .kpi-val  { color: var(--green); }
  .kpi.c-orange .kpi-val { color: var(--orange); }
  .kpi-sub { font-size: 11px; color: var(--text-3); margin-top: 4px; }

  /* RESULT PANELS */
  .result-card {
    background: var(--bg-white);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    margin-bottom: 14px;
  }
  .result-card:last-child { margin-bottom: 0; }
  .result-card-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--blue-text);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }

  /* MACHINE SUMMARY GRID */
  .ms-row { display: grid; grid-template-columns: repeat(4,1fr); gap: 12px; }
  .ms-cell .ms-lbl { font-size: 11px; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 4px; font-weight: 500; }
  .ms-cell .ms-val { font-size: 20px; font-weight: 700; }
  .ms-val.blue   { color: var(--blue); }
  .ms-val.green  { color: var(--green); }
  .ms-val.orange { color: var(--orange); }

  /* DOZ BREAKDOWN */
  .doz-row-r {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #eef3f8;
  }
  .doz-row-r:last-child { border-bottom: none; padding-bottom: 0; }
  .doz-rname { font-weight: 600; font-size: 13px; }
  .doz-meta  { font-size: 11px; color: var(--text-3); margin-top: 3px; line-height: 1.7; }
  .pbar { height: 5px; background: #dde8f4; border-radius: 3px; margin-top: 8px; max-width: 240px; }
  .pbar-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--blue), #5ba8f5); transition: width .8s; }
  .mbig  { font-size: 28px; font-weight: 700; color: var(--blue); line-height: 1; text-align: right; }
  .msub2 { font-size: 11px; color: var(--text-3); text-align: right; }

  /* PRODUCTS TABLE */
  .tbl-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: 12.5px; }
  th {
    font-size: 10.5px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
    color: var(--text-3); text-align: left;
    padding: 7px 10px; border-bottom: 2px solid var(--border);
    white-space: nowrap; background: #f7fafd;
  }
  td { padding: 9px 10px; border-bottom: 1px solid #eef3f8; white-space: nowrap; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: #f7fafd; }
  .tn { text-align: right; font-variant-numeric: tabular-nums; }
  .tprofit { text-align: right; color: var(--green); font-weight: 600; }
  .ttotal td { border-top: 2px solid var(--border); font-weight: 600; background: var(--blue-light); }

  /* CHART */
  .chart-wrap { position: relative; height: 210px; margin-top: 4px; }

  /* ANNUAL */
  .annual-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-top: 14px; }
  .an-lbl { font-size: 11px; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 5px; font-weight: 500; }
  .an-val { font-size: 22px; font-weight: 700; }
  .an-val.blue   { color: var(--blue); }
  .an-val.green  { color: var(--green); }
  .an-val.orange { color: var(--orange); }

  /* HINT */
  .hint { font-size: 11px; color: var(--text-3); margin-top: 4px; line-height: 1.5; }

  #results { display: none; flex-direction: column; }
  #results.visible { display: flex; }
  .fade-in { animation: fi .3s ease both; }
  @keyframes fi { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #eef3f8; }
  ::-webkit-scrollbar-thumb { background: #c5d5e8; border-radius: 3px; }

  @media (max-width: 900px) {
    .app { grid-template-columns: 1fr; }
    .kpi-grid { grid-template-columns: 1fr 1fr; }
    .ms-row { grid-template-columns: 1fr 1fr; }
    .annual-grid { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header>
  <div class="header-left">
    <!-- Atlas Pro logo -->
    <a class="logo-wrap" href="#">
      <svg class="logo-icon" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- outer triangle -->
        <polygon points="21,3 39,36 3,36" fill="none" stroke="#2563a8" stroke-width="2.5" stroke-linejoin="round"/>
        <!-- inner filled triangle -->
        <polygon points="21,10 34,33 8,33" fill="#2b7de9" opacity="0.18"/>
        <!-- middle triangle -->
        <polygon points="21,13 31,31 11,31" fill="none" stroke="#2b7de9" stroke-width="1.5" stroke-linejoin="round"/>
        <!-- center dot -->
        <circle cx="21" cy="28" r="2.2" fill="#2b7de9"/>
      </svg>
      <div class="logo-text-block">
        <span class="logo-name">–ê–¢–õ–ê–°</span>
        <span class="logo-tagline">–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏<br>–¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å—Ç–∏—Ä–∫–∏</span>
      </div>
    </a>
    <div class="header-divider"></div>
    <div class="header-title">
      <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –¥–æ–∑–∞—Ç–æ—Ä–∞</h1>
      <p>–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –∏ –ø—Ä–∏–±—ã–ª—å –æ—Ç –ø—Ä–æ–¥–∞–∂ –º–æ—é—â–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤</p>
    </div>
  </div>
  <button class="btn-orange" onclick="window.print()">–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app">

  <!-- ‚ïê‚ïê‚ïê LEFT COLUMN ‚ïê‚ïê‚ïê -->
  <div class="left-col">

    <!-- DOZATORS -->
    <div class="card">
      <div class="card-title">–î–æ–∑–∞—Ç–æ—Ä—ã –∏ –º–∞—à–∏–Ω—ã</div>
      <div id="doz-list"></div>
      <button class="btn-add" onclick="addDoz()">+ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∑–∞—Ç–æ—Ä</button>
    </div>

    <!-- PRODUCTS -->
    <div class="card">
      <div class="card-title" style="color: var(--orange); border-bottom-color: #fde8cc;">–ú–æ—é—â–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</div>
      <div id="prod-list"></div>
      <button class="btn-add btn-add-orange" onclick="addProd()">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–æ</button>
    </div>

    <!-- SETTINGS -->
    <div class="card">
      <div class="card-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞</div>
      <div class="field" style="margin-bottom:0">
        <label>–ì–æ—Ä–∏–∑–æ–Ω—Ç —Ä–∞—Å—á—ë—Ç–∞ <span class="unit">(–º–µ—Å—è—Ü–µ–≤)</span></label>
        <input type="number" id="horizon" value="36" min="6" max="120">
      </div>
    </div>

    <button class="btn-calc" onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê RIGHT COLUMN ‚ïê‚ïê‚ïê -->
  <div class="right-col">

    <div class="placeholder" id="placeholder">
      <div class="ico">üìä</div>
      <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–µ–≤–∞<br>–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å¬ª</p>
    </div>

    <div id="results"></div>

  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let dozId = 0, prodId = 0;
let dozators = [], products = [];

const $ = id => document.getElementById(id);
const val = id => parseFloat($(`${id}`)?.value) || 0;
const str = id => $(`${id}`)?.value?.trim() || '';

function fmt(n, d = 0) {
  if (!isFinite(n)) return '‚àû';
  return new Intl.NumberFormat('ru-RU', { maximumFractionDigits: d }).format(n);
}
function fmtRub(n) {
  if (!isFinite(n)) return '‚àû ‚ÇΩ';
  return fmt(Math.round(n)) + ' ‚ÇΩ';
}

// ‚îÄ‚îÄ‚îÄ LIVE PREVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateDozPreview(id) {
  const vol    = val(`dvol-${id}`);
  const prog   = val(`dprog-${id}`);
  const shift  = val(`dshift-${id}`);
  const shifts = val(`dshifts-${id}`);
  const days   = val(`ddays-${id}`);
  const wps    = prog > 0 ? Math.floor((shift * 60) / prog) : 0;
  const wpd    = wps * shifts;
  const wpm    = wpd * days;
  const el = $(`doz-preview-${id}`);
  if (el) el.innerHTML =
    `‚öô <strong>${wps}</strong> —Å—Ç–∏—Ä–æ–∫/—Å–º–µ–Ω—É &nbsp;¬∑&nbsp; <strong>${wpd}</strong>/–¥–µ–Ω—å &nbsp;¬∑&nbsp; <strong style="color:var(--blue)">${wpm}</strong>/–º–µ—Å`;
}

// ‚îÄ‚îÄ‚îÄ ADD DOZATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addDoz(def = {}) {
  const id = ++dozId;
  dozators.push(id);
  const div = document.createElement('div');
  div.className = 'doz-item';
  div.id = `doz-${id}`;
  div.innerHTML = `
    <div class="item-hd">
      <span class="item-name">–î–æ–∑–∞—Ç–æ—Ä #${id}</span>
      <button class="btn-del" onclick="removeDoz(${id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
    </div>
    <div class="field">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input type="text" id="dn-${id}" value="${def.name || '–î–æ–∑–∞—Ç–æ—Ä #' + id}">
    </div>
    <div class="row2">
      <div class="field">
        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è <span class="unit">(‚ÇΩ)</span></label>
        <input type="number" id="dc-${id}" value="${def.cost ?? 25000}" min="0">
      </div>
      <div class="field">
        <label>–ú–æ–Ω—Ç–∞–∂ / —É—Å—Ç–∞–Ω–æ–≤–∫–∞ <span class="unit">(‚ÇΩ)</span></label>
        <input type="number" id="di-${id}" value="${def.install ?? 3000}" min="0">
      </div>
    </div>
    <div class="sub-sec">
      <div class="sub-sec-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—à–∏–Ω—ã</div>
      <div class="row2">
        <div class="field">
          <label>–û–±—ä—ë–º –º–∞—à–∏–Ω—ã <span class="unit">(–∫–≥)</span></label>
          <input type="number" id="dvol-${id}" value="${def.vol ?? 10}" min="0.1" step="0.1" oninput="updateDozPreview(${id})">
        </div>
        <div class="field">
          <label>–í—Ä–µ–º—è –ø—Ä–æ–≥—Ä–∞–º–º—ã <span class="unit">(–º–∏–Ω)</span></label>
          <input type="number" id="dprog-${id}" value="${def.prog ?? 45}" min="1" oninput="updateDozPreview(${id})">
        </div>
      </div>
      <div class="row3">
        <div class="field">
          <label>–î–ª–∏—Ç. —Å–º–µ–Ω—ã <span class="unit">(—á)</span></label>
          <input type="number" id="dshift-${id}" value="${def.shift ?? 8}" min="0.5" step="0.5" oninput="updateDozPreview(${id})">
        </div>
        <div class="field">
          <label>–°–º–µ–Ω –≤ –¥–µ–Ω—å</label>
          <input type="number" id="dshifts-${id}" value="${def.shifts ?? 2}" min="1" max="4" oninput="updateDozPreview(${id})">
        </div>
        <div class="field">
          <label>–†–∞–±. –¥–Ω–µ–π/–º–µ—Å</label>
          <input type="number" id="ddays-${id}" value="${def.days ?? 22}" min="1" max="31" oninput="updateDozPreview(${id})">
        </div>
      </div>
      <div class="derived" id="doz-preview-${id}">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    </div>
  `;
  $('doz-list').appendChild(div);
  updateDozPreview(id);
}

function removeDoz(id) {
  dozators = dozators.filter(x => x !== id);
  $(`doz-${id}`)?.remove();
}

// ‚îÄ‚îÄ‚îÄ ADD PRODUCT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addProd(def = {}) {
  const id = ++prodId;
  products.push(id);
  const div = document.createElement('div');
  div.className = 'prod-item';
  div.id = `prod-${id}`;
  div.innerHTML = `
    <div class="item-hd">
      <span class="item-name">–°—Ä–µ–¥—Å—Ç–≤–æ #${id}</span>
      <button class="btn-del" onclick="removeProd(${id})">‚úï</button>
    </div>
    <div class="field">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input type="text" id="pn-${id}" value="${def.name || '–°—Ä–µ–¥—Å—Ç–≤–æ #' + id}">
    </div>
    <div class="row2">
      <div class="field">
        <label>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ <span class="unit">(‚ÇΩ/–∫–≥)</span></label>
        <input type="number" id="ps-${id}" value="${def.sale ?? 450}" min="0" step="0.01">
      </div>
      <div class="field">
        <label>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å <span class="unit">(‚ÇΩ/–∫–≥)</span></label>
        <input type="number" id="pp-${id}" value="${def.cost ?? 180}" min="0" step="0.01">
      </div>
    </div>
    <div class="row2">
      <div class="field">
        <label>–î–æ–∑–∞ <span class="unit">(–º–ª/–≥ –Ω–∞ –∫–≥ –∑–∞–≥—Ä—É–∑–∫–∏)</span></label>
        <input type="number" id="pd-${id}" value="${def.dose ?? 10}" min="0.01" step="0.1">
      </div>
      <div class="field">
        <label>–Å–º–∫–æ—Å—Ç—å –∫–∞–Ω–∏—Å—Ç—Ä—ã <span class="unit">(–∫–≥)</span></label>
        <input type="number" id="pk-${id}" value="${def.can ?? 20}" min="0.1" step="0.1">
      </div>
    </div>
    <div class="hint">üí° –†–∞—Å—Ö–æ–¥/—Å—Ç–∏—Ä–∫—É = –î–æ–∑–∞ √ó –û–±—ä—ë–º –º–∞—à–∏–Ω—ã (–∫–≥). –ü–ª–æ—Ç–Ω–æ—Å—Ç—å ‚âà 1 –∫–≥/–ª.</div>
  `;
  $('prod-list').appendChild(div);
}

function removeProd(id) {
  products = products.filter(x => x !== id);
  $(`prod-${id}`)?.remove();
}

// ‚îÄ‚îÄ‚îÄ CALCULATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculate() {
  const horizon = Math.min(120, Math.max(6, parseInt($('horizon').value) || 36));
  if (!dozators.length) { alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–æ–∑–∞—Ç–æ—Ä!'); return; }
  if (!products.length)  { alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –º–æ—é—â–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ!'); return; }

  const dozData = dozators.map(id => {
    const vol    = val(`dvol-${id}`);
    const prog   = val(`dprog-${id}`);
    const shift  = val(`dshift-${id}`);
    const shifts = val(`dshifts-${id}`);
    const days   = val(`ddays-${id}`);
    const wps  = prog > 0 ? Math.floor((shift * 60) / prog) : 0;
    const wpd  = wps * shifts;
    const wpm  = wpd * days;
    return {
      id, vol, prog, shift, shifts, days,
      washesPerShift: wps, washesPerDay: wpd, washesPerMonth: wpm,
      name:    str(`dn-${id}`) || `–î–æ–∑–∞—Ç–æ—Ä #${id}`,
      cost:    val(`dc-${id}`),
      install: val(`di-${id}`),
      get invest() { return this.cost + this.install; }
    };
  });

  const prodData = products.map(id => ({
    id,
    name: str(`pn-${id}`) || `–°—Ä–µ–¥—Å—Ç–≤–æ #${id}`,
    sale: val(`ps-${id}`),
    cost: val(`pp-${id}`),
    dose: val(`pd-${id}`),
    can:  val(`pk-${id}`),
    get margin() { return this.sale > 0 ? (this.sale - this.cost) / this.sale * 100 : 0; }
  }));

  const totalInvest = dozData.reduce((s, d) => s + d.invest, 0);
  let totalRevMo = 0, totalPrfMo = 0;

  const prodRows = prodData.map(p => {
    let revMo = 0, cstMo = 0, kgMo = 0, canMo = 0;
    dozData.forEach(d => {
      const kgPerWash = p.dose * d.vol / 1000;
      const kgM = kgPerWash * d.washesPerMonth;
      revMo += kgM * p.sale;
      cstMo += kgM * p.cost;
      kgMo  += kgM;
      canMo += kgM / p.can;
    });
    const prfMo = revMo - cstMo;
    totalRevMo += revMo;
    totalPrfMo += prfMo;
    return { ...p, revMo, cstMo, prfMo, kgMo, canMo };
  });

  const globalPayback    = totalPrfMo > 0 ? totalInvest / totalPrfMo : Infinity;
  const profitAtHorizon  = totalPrfMo * horizon - totalInvest;
  const curve = Array.from({ length: horizon + 1 }, (_, m) =>
    m === 0 ? -totalInvest : totalPrfMo * m - totalInvest
  );
  const dozAnalysis = dozData.map(d => ({
    ...d, payback: totalPrfMo > 0 ? d.invest / totalPrfMo : Infinity
  }));

  render({ dozData, dozAnalysis, prodRows, totalRevMo, totalPrfMo, totalInvest, globalPayback, curve, profitAtHorizon, horizon });
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render(d) {
  $('placeholder').style.display = 'none';
  const res = $('results');
  res.innerHTML = '';
  res.className = 'visible fade-in';

  const { dozData, dozAnalysis, prodRows, totalRevMo, totalPrfMo, totalInvest, globalPayback, curve, profitAtHorizon, horizon } = d;
  const pb = isFinite(globalPayback) && globalPayback < 1000;
  const totalWpm   = dozData.reduce((s, d) => s + d.washesPerMonth, 0);
  const totalKgMo  = prodRows.reduce((s, p) => s + p.kgMo, 0);
  const totalCanMo = prodRows.reduce((s, p) => s + p.canMo, 0);

  // ‚îÄ‚îÄ KPI
  const kpiDiv = document.createElement('div');
  kpiDiv.className = 'kpi-grid';
  kpiDiv.innerHTML = `
    <div class="kpi c-blue">
      <div class="kpi-lbl">–°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</div>
      <div class="kpi-val">${pb ? Math.ceil(globalPayback) + ' –º–µ—Å' : '‚àû'}</div>
      <div class="kpi-sub">${pb ? '–¥–æ –ø–æ–ª–Ω–æ–π –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏' : '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏–±—ã–ª–∏'}</div>
    </div>
    <div class="kpi c-green">
      <div class="kpi-lbl">–ü—Ä–∏–±—ã–ª—å –≤ –º–µ—Å—è—Ü</div>
      <div class="kpi-val">${fmtRub(totalPrfMo)}</div>
      <div class="kpi-sub">–≤—ã—Ä—É—á–∫–∞ ${fmtRub(totalRevMo)}</div>
    </div>
    <div class="kpi c-orange">
      <div class="kpi-lbl">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
      <div class="kpi-val">${fmtRub(totalInvest)}</div>
      <div class="kpi-sub">–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ + –º–æ–Ω—Ç–∞–∂</div>
    </div>
    <div class="kpi c-green">
      <div class="kpi-lbl">–ü—Ä–∏–±—ã–ª—å –∑–∞ ${horizon} –º–µ—Å</div>
      <div class="kpi-val">${fmtRub(Math.max(0, profitAtHorizon))}</div>
      <div class="kpi-sub">${profitAtHorizon < 0 ? '‚ö† —É–±—ã—Ç–æ–∫ ' + fmtRub(-profitAtHorizon) : '–ø–æ—Å–ª–µ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏'}</div>
    </div>
    <div class="kpi c-blue">
      <div class="kpi-lbl">–°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞</div>
      <div class="kpi-val">${totalRevMo > 0 ? fmt(totalPrfMo / totalRevMo * 100, 1) + '%' : '‚Äî'}</div>
      <div class="kpi-sub">–ø–æ –≤—Å–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º</div>
    </div>
    <div class="kpi c-orange">
      <div class="kpi-lbl">ROI –∑–∞ ${horizon} –º–µ—Å</div>
      <div class="kpi-val">${totalInvest > 0 && profitAtHorizon > 0 ? fmt(profitAtHorizon / totalInvest * 100, 0) + '%' : '‚Äî'}</div>
      <div class="kpi-sub">–≤–æ–∑–≤—Ä–∞—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
    </div>
  `;
  res.appendChild(kpiDiv);

  // ‚îÄ‚îÄ MACHINE LOAD SUMMARY
  const ms = document.createElement('div');
  ms.className = 'result-card';
  ms.innerHTML = `
    <div class="result-card-title">–ù–∞–≥—Ä—É–∑–∫–∞ ‚Äî –≤ –º–µ—Å—è—Ü</div>
    <div class="ms-row">
      <div class="ms-cell"><div class="ms-lbl">–°—Ç–∏—Ä–æ–∫ / –º–µ—Å</div><div class="ms-val blue">${fmt(totalWpm)}</div></div>
      <div class="ms-cell"><div class="ms-lbl">–†–∞—Å—Ö–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</div><div class="ms-val orange">${fmt(totalKgMo,1)} –∫–≥</div></div>
      <div class="ms-cell"><div class="ms-lbl">–ö–∞–Ω–∏—Å—Ç—Ä / –º–µ—Å</div><div class="ms-val green">${fmt(totalCanMo,1)} —à—Ç</div></div>
      <div class="ms-cell"><div class="ms-lbl">–î–æ–∑–∞—Ç–æ—Ä–æ–≤</div><div class="ms-val blue">${dozData.length} —à—Ç</div></div>
    </div>
  `;
  res.appendChild(ms);

  // ‚îÄ‚îÄ CHART
  const chartCard = document.createElement('div');
  chartCard.className = 'result-card';
  chartCard.innerHTML = `
    <div class="result-card-title">–ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫</div>
    <div class="chart-wrap"><canvas id="roi-canvas"></canvas></div>
  `;
  res.appendChild(chartCard);
  setTimeout(() => drawChart('roi-canvas', curve, horizon, globalPayback), 40);

  // ‚îÄ‚îÄ DOZ BREAKDOWN
  const bk = document.createElement('div');
  bk.className = 'result-card';
  bk.innerHTML = `<div class="result-card-title">–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å –ø–æ –¥–æ–∑–∞—Ç–æ—Ä–∞–º</div>` +
    dozAnalysis.map(dz => {
      const pct  = isFinite(dz.payback) ? Math.min(100, (dz.payback / horizon) * 100) : 100;
      const pbOk = isFinite(dz.payback) && dz.payback < 1000;
      return `
      <div class="doz-row-r">
        <div style="flex:1">
          <div class="doz-rname">${dz.name}</div>
          <div class="doz-meta">
            –ú–∞—à–∏–Ω–∞ ${dz.vol} –∫–≥ ¬∑ –ø—Ä–æ–≥—Ä–∞–º–º–∞ ${dz.prog} –º–∏–Ω ¬∑ —Å–º–µ–Ω–∞ ${dz.shift} —á √ó ${dz.shifts}/–¥–µ–Ω—å ¬∑ ${dz.days} –¥–Ω–µ–π/–º–µ—Å<br>
            ${fmt(dz.washesPerShift)} —Å—Ç/—Å–º–µ–Ω—É ¬∑ ${fmt(dz.washesPerDay)} —Å—Ç/–¥–µ–Ω—å ¬∑ <strong style="color:var(--blue)">${fmt(dz.washesPerMonth)} —Å—Ç/–º–µ—Å</strong><br>
            –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: ${fmtRub(dz.cost)} + ${fmtRub(dz.install)} = <strong>${fmtRub(dz.invest)}</strong>
          </div>
          <div class="pbar"><div class="pbar-fill" style="width:${pct}%"></div></div>
        </div>
        <div style="margin-left:20px;flex-shrink:0">
          <div class="mbig">${pbOk ? Math.ceil(dz.payback) : '‚àû'}</div>
          <div class="msub2">–º–µ—Å. –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å</div>
        </div>
      </div>`;
    }).join('');
  res.appendChild(bk);

  // ‚îÄ‚îÄ PRODUCTS TABLE
  const tbl = document.createElement('div');
  tbl.className = 'result-card';
  tbl.innerHTML = `
    <div class="result-card-title">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º ‚Äî –≤ –º–µ—Å—è—Ü</div>
    <div class="tbl-wrap">
      <table>
        <thead>
          <tr>
            <th>–°—Ä–µ–¥—Å—Ç–≤–æ</th>
            <th style="text-align:right">–î–æ–∑–∞</th>
            <th style="text-align:right">–¶–µ–Ω–∞ / –∫–≥</th>
            <th style="text-align:right">–°/–° / –∫–≥</th>
            <th style="text-align:right">–ú–∞—Ä–∂–∞</th>
            <th style="text-align:right">–†–∞—Å—Ö–æ–¥, –∫–≥</th>
            <th style="text-align:right">–ö–∞–Ω–∏—Å—Ç—Ä</th>
            <th style="text-align:right">–í—ã—Ä—É—á–∫–∞</th>
            <th style="text-align:right">–ü—Ä–∏–±—ã–ª—å</th>
          </tr>
        </thead>
        <tbody>
          ${prodRows.map(p => `
            <tr>
              <td style="font-weight:500">${p.name}</td>
              <td class="tn">${fmt(p.dose,1)} –º–ª/–∫–≥</td>
              <td class="tn">${fmtRub(p.sale)}</td>
              <td class="tn">${fmtRub(p.cost)}</td>
              <td class="tn">${fmt(p.margin,1)}%</td>
              <td class="tn">${fmt(p.kgMo,2)}</td>
              <td class="tn">${fmt(p.canMo,2)}</td>
              <td class="tn">${fmtRub(p.revMo)}</td>
              <td class="tprofit">+ ${fmtRub(p.prfMo)}</td>
            </tr>
          `).join('')}
          <tr class="ttotal">
            <td colspan="5">–ò—Ç–æ–≥–æ</td>
            <td class="tn">${fmt(totalKgMo,2)}</td>
            <td class="tn">${fmt(totalCanMo,2)}</td>
            <td class="tn">${fmtRub(d.totalRevMo)}</td>
            <td class="tprofit">+ ${fmtRub(d.totalPrfMo)}</td>
          </tr>
        </tbody>
      </table>
    </div>
  `;
  res.appendChild(tbl);

  // ‚îÄ‚îÄ ANNUAL
  const ann = document.createElement('div');
  ann.className = 'result-card';
  ann.innerHTML = `
    <div class="result-card-title">–ü—Ä–æ–≥–Ω–æ–∑ ‚Äî 12 –º–µ—Å—è—Ü–µ–≤</div>
    <div class="annual-grid">
      <div><div class="an-lbl">–í—ã—Ä—É—á–∫–∞ –∑–∞ –≥–æ–¥</div><div class="an-val blue">${fmtRub(totalRevMo * 12)}</div></div>
      <div><div class="an-lbl">–ü—Ä–∏–±—ã–ª—å –∑–∞ –≥–æ–¥</div><div class="an-val green">${fmtRub(totalPrfMo * 12)}</div></div>
      <div><div class="an-lbl">–ö–∞–Ω–∏—Å—Ç—Ä –∑–∞ –≥–æ–¥</div><div class="an-val orange">${fmt(totalCanMo * 12, 0)} —à—Ç</div></div>
    </div>
  `;
  res.appendChild(ann);
}

// ‚îÄ‚îÄ‚îÄ CANVAS CHART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawChart(canvasId, curve, horizon, payback) {
  const canvas = $(canvasId);
  if (!canvas) return;
  const W   = canvas.parentElement.clientWidth;
  const H   = 210;
  const DPR = window.devicePixelRatio || 1;
  canvas.width  = W * DPR;
  canvas.height = H * DPR;
  canvas.style.width  = W + 'px';
  canvas.style.height = H + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(DPR, DPR);

  const P = { t:14, r:16, b:30, l:88 };
  const cw = W - P.l - P.r;
  const ch = H - P.t - P.b;
  const minV = Math.min(...curve);
  const maxV = Math.max(...curve);
  const range = (maxV - minV) || 1;

  const tx = m => P.l + (m / horizon) * cw;
  const ty = v => P.t + ch - ((v - minV) / range) * ch;

  // grid bg
  ctx.fillStyle = '#f7fafd';
  ctx.fillRect(P.l, P.t, cw, ch);

  // grid lines + y labels
  ctx.font = '11px Inter';
  ctx.fillStyle = '#8a9ab0';
  ctx.textAlign = 'right';
  [0,1,2,3,4].forEach(s => {
    const v = minV + (range / 4) * s;
    const y = ty(v);
    const abs = Math.abs(v);
    const lbl = abs >= 1000000 ? fmt(v/1000000,1)+' –º–ª–Ω'
              : abs >= 1000    ? fmt(v/1000,0)+' —Ç—ã—Å'
              : fmt(v,0);
    ctx.fillText(lbl + ' ‚ÇΩ', P.l - 6, y + 4);
    ctx.strokeStyle = '#dde8f4';
    ctx.lineWidth = 0.8;
    ctx.beginPath(); ctx.moveTo(P.l, y); ctx.lineTo(P.l + cw, y); ctx.stroke();
  });

  // zero line
  ctx.strokeStyle = '#b0c8e4';
  ctx.lineWidth = 1.2;
  ctx.setLineDash([4,5]);
  ctx.beginPath(); ctx.moveTo(P.l, ty(0)); ctx.lineTo(P.l+cw, ty(0)); ctx.stroke();
  ctx.setLineDash([]);

  // payback vertical
  if (isFinite(payback) && payback <= horizon) {
    const px = tx(payback);
    ctx.strokeStyle = 'rgba(43,125,233,.5)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([5,4]);
    ctx.beginPath(); ctx.moveTo(px, P.t); ctx.lineTo(px, P.t + ch); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(43,125,233,.9)';
    ctx.font = '11px Inter';
    ctx.textAlign = 'left';
    const lx = (px + 80 > W - P.r) ? px - 78 : px + 4;
    ctx.fillText('‚Üë ' + Math.ceil(payback) + ' –º–µ—Å', lx, P.t + 14);
  }

  // negative area (below zero)
  const zy = ty(0);
  const gradNeg = ctx.createLinearGradient(0, zy, 0, P.t + ch);
  gradNeg.addColorStop(0, 'rgba(217,59,59,.08)');
  gradNeg.addColorStop(1, 'rgba(217,59,59,.18)');
  ctx.fillStyle = gradNeg;
  ctx.beginPath();
  ctx.moveTo(tx(0), Math.min(zy, ty(curve[0])));
  curve.forEach((v, m) => { if (v < 0) ctx.lineTo(tx(m), ty(v)); });
  // close below zero
  const lastNeg = curve.findIndex((v, i) => i > 0 && v >= 0);
  if (lastNeg > 0) ctx.lineTo(tx(lastNeg-1), zy);
  ctx.lineTo(tx(0), zy);
  ctx.closePath(); ctx.fill();

  // positive area
  const gradPos = ctx.createLinearGradient(0, P.t, 0, zy);
  gradPos.addColorStop(0, 'rgba(26,158,92,.18)');
  gradPos.addColorStop(1, 'rgba(26,158,92,.04)');
  ctx.fillStyle = gradPos;
  ctx.beginPath();
  ctx.moveTo(tx(0), ty(Math.max(0, curve[0])));
  curve.forEach((v, m) => { if (v >= 0) ctx.lineTo(tx(m), ty(v)); });
  const firstPos = curve.findIndex(v => v >= 0);
  if (firstPos > 0) ctx.lineTo(tx(firstPos), zy);
  ctx.lineTo(tx(0), zy);
  ctx.closePath(); ctx.fill();

  // main line
  ctx.strokeStyle = '#2b7de9';
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  ctx.beginPath();
  curve.forEach((v, m) => m === 0 ? ctx.moveTo(tx(m), ty(v)) : ctx.lineTo(tx(m), ty(v)));
  ctx.stroke();

  // x labels
  ctx.fillStyle = '#8a9ab0';
  ctx.textAlign = 'center';
  ctx.font = '11px Inter';
  const step = Math.ceil(horizon / 6);
  for (let m = 0; m <= horizon; m += step) ctx.fillText(m + ' –º', tx(m), H - 4);

  // border
  ctx.strokeStyle = '#dde8f4';
  ctx.lineWidth = 1;
  ctx.strokeRect(P.l, P.t, cw, ch);
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
addDoz({ name: '–ú–∞—à–∏–Ω–∞ 1 (10 –∫–≥)', cost: 25000, install: 3000, vol: 10, prog: 45, shift: 8, shifts: 2, days: 22 });
addProd({ name: '–°—Ç–∏—Ä–∞–ª—å–Ω–æ–µ –∂–∏–¥–∫–æ–µ', sale: 450, cost: 178, dose: 10, can: 20 });
addProd({ name: '–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä',       sale: 320, cost: 120, dose: 4,  can: 20 });
addProd({ name: '–û—Ç–±–µ–ª–∏–≤–∞—Ç–µ–ª—å',      sale: 280, cost: 100, dose: 7,  can: 10 });
</script>
</body>
</html>
